<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width">
  <title>recipeEASY</title>
  <link rel="stylesheet" href="stylesheets/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Literata&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
  <link rel="icon" type="image/x-icon" href="/img/favicon_logo.ico">

</head>
<body>
  <div class="header">
    <h1>recipeEASY</h1>
    <div class="auth">
      <a href="#">Sign In</a>
      <a href="#">Create Account</a>
    </div>
  </div>

  <nav class="nav">
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="allRecipes.html">All Recipes</a></li>
      <li><a href="cookbook.html">Cookbook</a></li>
    </ul>
  </nav>

  <div class="content">
    <div class="content-header">
      <h1 id="recipe-name">Loading Recipe...</h1>
    </div>

    <span class="material-symbols-outlined heart">favorite</span><span id="recipe-likes"></span> &nbsp;&nbsp; 
    <span class="material-symbols-outlined">visibility</span><span id="recipe-views"></span>

    <h2>Summary</h2>
    <p id="recipe-summary">Loading summary...</p>

    <h2>Ingredients</h2>
    <div id="ingredients-list" class="ingredients-list"></div>

    <h2>Allergens</h2>
    <ul id="recipe-allergens"></ul>

    <h2>Comments</h2>
    <div class="comments-container"></div>
  </div>

  <!-- load recipe info from /recipes:id controller -->
  <script>
    function getRecipeIdFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id');
    }

    async function loadRecipe() {
      const recipeId = getRecipeIdFromURL();
      if (!recipeId) {
        document.getElementById("recipe-name").innerText = "Recipe not found";
        return;
      }

      try {
        const response = await fetch(`/api/recipes/${recipeId}`);
        const recipe = await response.json();

        document.getElementById("recipe-likes").innerText = recipe.likes || "0";
        document.getElementById("recipe-views").innerText = recipe.views || "0";

        document.getElementById("recipe-name").innerText = recipe.recipeName || "Untitled Recipe";
        document.getElementById("recipe-summary").innerText = recipe.recipeDescription || "No description available.";

        // Ingredients
        const ingredientsContainer = document.getElementById("ingredients-list");
        ingredientsContainer.innerHTML = recipe.recipeIngredients && recipe.recipeIngredients.length > 0
          ? recipe.recipeIngredients.map(ing => `<div>${ing}</div>`).join('')
          : "<div>No ingredients listed.</div>";

        // Allergens
        const allergensList = document.getElementById("recipe-allergens");
        allergensList.innerHTML = recipe.recipeAllergens && recipe.recipeAllergens.length > 0
          ? recipe.recipeAllergens.map(all => `<li>${all}</li>`).join('')
          : "<li>No allergens listed.</li>";

      } catch (err) {
        document.getElementById("recipe-name").innerText = "Error loading recipe.";
        console.error("Failed to load recipe:", err);
      }
    }

    loadRecipe();
  </script>
</body>
</html>
